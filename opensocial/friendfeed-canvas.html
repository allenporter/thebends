<style>
.text {
  font-family:"lucida grande",tahoma,verdana,arial,sans-serif;
  font-size:11px
}
</style>
<script>
  function load() {
      var req = opensocial.newDataRequest();
      req.add(req.newFetchPersonAppDataRequest(opensocial.DataRequest.PersonId.VIEWER, "friendfeed-nickname"),
                  "loading");
      req.send(loadComplete);
  }

  // There has to be a better way. What is the users friend id?
  function getFirstResult(data) {
    for (var member in data) {
      return data[member];
    }
  }

  function loadComplete(data) {
    var nicknameData = data.get("loading");
    var form = document.getElementById('friendfeedprefs');
    form.nickname.value = '';
    if (!nicknameData.hadError()) {
        var data = getFirstResult(nicknameData.getData());
        form.nickname.value = data["friendfeed-nickname"];
    }
    form.savebutton.disabled = '';
    form.nickname.disabled = '';
  }

  function save(form) {
      var nickname = form.nickname.value;
      var req = opensocial.newDataRequest();
      req.add(req.newUpdatePersonAppDataRequest(
                      opensocial.DataRequest.PersonId.VIEWER,
                      "friendfeed-nickname", nickname),
                  "saving");
      req.send(saveComplete);
   }

  function saveComplete(data) {
    if (data.hadError()) {
      alert("Error saving");
      return;
    }
    var nickname = data.get("saving");
    if (nickname.hadError()) {
      alert(nickname.getErrorMessage());
      return;
    }
    alert("Saved!");
  }

</script>
<div class=text style="width:290">
<img src="http://friendfeed.com/static/images/logo-small.png" width=160 height=34><br>
<hr size=1 color=blue>

<form id="friendfeedprefs">
FriendFeed nickname or email: <input type=text name="nickname" size=20 disabled="disabled" value="Loading..."><br>
<input name="savebutton" type=button value=Save onclick="save(this.form);" disabled="disabled">
</form>

</div>
<script>
  load();
</script>
